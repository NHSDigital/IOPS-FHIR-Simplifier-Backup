<?xml version="1.0" encoding="utf-8"?>
<StructureDefinition xmlns="http://hl7.org/fhir">
  <id value="England-MedicationRequest" />
  <url value="https://fhir.nhs.uk/StructureDefinition/England-MedicationRequest" />
  <version value="1.0.0" />
  <name value="EnglandMedicationRequest" />
  <title value="England MedicationRequest" />
  <status value="draft" />
  <date value="2023-08-18" />
  <publisher value="NHS England" />
  <contact>
    <name value="NHS England" />
    <telecom>
      <system value="email" />
      <value value="interoperabilityteam@nhs.net" />
      <use value="work" />
      <rank value="1" />
    </telecom>
  </contact>
  <description value="This profile defines the NHS England constraints and extensions on the FHIR UK Core resource [UK Core MedicationRequest](https://simplifier.net/hl7fhirukcorer4/ukcore-MedicationRequest)." />
  <purpose value="An order or request for both supply of the medication and the instructions for administration of the medication to an individual. \n\nThis profile covers inpatient medication orders as well as community orders (whether filled by the prescriber or by a pharmacy). It also includes orders for over-the-counter medications (e.g. Aspirin), total parenteral nutrition and diet/ vitamin supplements, and may be used to support the order of medication-related devices. \n\nIt is not intended for use in prescribing particular diets, or for ordering non-medication-related items (eyeglasses, supplies, etc)." />
  <copyright value="Copyright © 2023+ NHS England Licensed under the Apache License, Version 2.0 (the \&quot;License\&quot;); you may not use this file except in compliance with the License. You may obtain a copy of the License at  http://www.apache.org/licenses/LICENSE-2.0 Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an \&quot;AS IS\&quot; BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. HL7® FHIR® standard Copyright © 2011+ HL7 The HL7® FHIR® standard is used under the FHIR license. You may obtain a copy of the FHIR license at  https://www.hl7.org/fhir/license.html." />
  <fhirVersion value="4.0.1" />
  <kind value="resource" />
  <abstract value="false" />
  <type value="MedicationRequest" />
  <baseDefinition value="https://fhir.hl7.org.uk/StructureDefinition/UKCore-MedicationRequest" />
  <derivation value="constraint" />
  <differential>
    <element id="MedicationRequest">
      <path value="MedicationRequest" />
      <constraint>
        <key value="nhse-mer-001" />
        <severity value="error" />
        <human value="medication[x] - Only one of medicationReference or medicationCodeableConcept should be provided" />
        <expression value="(medicationReference.exists() and medicationCodeableConcept.exists().not()) or (medicationReference.exists().not() and medicationCodeableConcept.exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-002" />
        <severity value="error" />
        <human value="Extension(responsiblePractitioner) - An identifier or resource reference must be provided" />
        <expression value="extension('https://fhir.nhs.uk/StructureDefinition/Extension-England-DMResponsiblePractitioner').exists().not() or (extension('https://fhir.nhs.uk/StructureDefinition/Extension-England-DMResponsiblePractitioner').value.reference.exists() or extension('https://fhir.nhs.uk/StructureDefinition/Extension-England-DMResponsiblePractitioner').value.system.exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-003" />
        <severity value="warning" />
        <human value="For continuous-repeat-dispensing intent must be reflex-order or original-order" />
        <expression value="(courseOfTherapyType.coding.code != 'continuous-repeat-dispensing') or ((courseOfTherapyType.coding.code = 'continuous-repeat-dispensing') and ((intent ='original-order') or (intent ='reflex-order')))" />
      </constraint>
      <constraint>
        <key value="nhse-mer-004" />
        <severity value="error" />
        <human value="For continuous intent must be instance-order or original-order" />
        <expression value="(courseOfTherapyType.coding.code != 'continuous') or ((courseOfTherapyType.coding.code = 'continuous') and ((intent ='original-order') or (intent ='instance-order')))" />
      </constraint>
      <constraint>
        <key value="nhse-mer-005" />
        <severity value="warning" />
        <human value="dispenseRequest.numberOfRepeatsAllowed should be populated for continuous and continuous-repeat-dispensing MedicationRequests." />
        <expression value="(courseOfTherapyType.coding.code.startsWith('acute')) or  (courseOfTherapyType.coding.code.startsWith('continuous') and dispenseRequest.exists() and dispenseRequest.numberOfRepeatsAllowed.exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-006" />
        <severity value="error" />
        <human value="For continuous-repeat-dispensing (intent=reflex-order) basedOn must be populated" />
        <expression value="(courseOfTherapyType.coding.code = 'acute') or (courseOfTherapyType.coding.code = 'continuous') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent !='reflex-order') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent ='reflex-order' and dispenseRequest.exists() and basedOn.exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-007" />
        <severity value="error" />
        <human value="For continuous-repeat-dispensing (intent=reflex-order) or continuous orders, numberOfRepeatsAllowed must be empty or equal to 0" />
        <expression value="(courseOfTherapyType.coding.code = 'acute') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent !='reflex-order') or ((courseOfTherapyType.coding.code = 'continuous' or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent ='reflex-order')) and (dispenseRequest.numberOfRepeatsAllowed.exists().not() or (dispenseRequest.numberOfRepeatsAllowed.exists() and dispenseRequest.numberOfRepeatsAllowed = 0)))" />
      </constraint>
      <constraint>
        <key value="nhse-mer-008" />
        <severity value="warning" />
        <human value="For continuous issues basedOn should be populated" />
        <expression value="(courseOfTherapyType.coding.code = 'acute') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing') or (courseOfTherapyType.coding.code = 'continuous' and dispenseRequest.exists() and basedOn.exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-009" />
        <severity value="error" />
        <human value="Extension repeatInformation.numberOfPrescriptionsIssued should not be present for continuous-repeat-dispensing that are not intent=reflex-order" />
        <expression value="(courseOfTherapyType.coding.code != 'continuous-repeat-dispensing') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent='reflex-order') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent!='reflex-order' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists().not()) or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent!='reflex-order' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists() and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').extension('numberOfPrescriptionsIssued').exists().not())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-010" />
        <severity value="error" />
        <human value="Extension repeatInformation.numberOfPrescriptionsIssued should be present for continuous-repeat-dispensing that have intent=reflex-order" />
        <expression value="(courseOfTherapyType.coding.code != 'continuous-repeat-dispensing') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent != 'reflex-order') or (courseOfTherapyType.coding.code = 'continuous-repeat-dispensing' and intent='reflex-order' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists() and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').extension('numberOfPrescriptionsIssued').exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-011" />
        <severity value="warning" />
        <human value="Extension repeatInformation.numberOfPrescriptionsIssued is recommend to be present for continuous issues" />
        <expression value="(courseOfTherapyType.coding.code != 'continuous') or (courseOfTherapyType.coding.code = 'continuous' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists() and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').extension('numberOfPrescriptionsIssued').exists())" />
      </constraint>
      <constraint>
        <key value="nhse-mer-012" />
        <severity value="error" />
        <human value="Extension repeatInformation.numberOfPrescriptionsIssued should not be present for acute issues" />
        <expression value="(courseOfTherapyType.coding.code != 'acute') or (courseOfTherapyType.coding.code = 'acute' and extension('https://fhir.hl7.org.uk/StructureDefinition/Extension-UKCore-MedicationRepeatInformation').exists().not())" />
      </constraint>
    </element>
    <element id="MedicationRequest.extension">
      <path value="MedicationRequest.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="0" />
    </element>
    <element id="MedicationRequest.extension:medicationRepeatInformation">
      <path value="MedicationRequest.extension" />
      <sliceName value="medicationRepeatInformation" />
      <short value="Continuous and Continuous Repeat Dispensing" />
      <min value="0" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.extension:responsiblePractitioner">
      <path value="MedicationRequest.extension" />
      <sliceName value="responsiblePractitioner" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMResponsiblePractitioner" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.extension:prescriptionEndorsement">
      <path value="MedicationRequest.extension" />
      <sliceName value="prescriptionEndorsement" />
      <min value="0" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMPrescriptionEndorsement" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.extension:prescriptionTaskStatusReason">
      <path value="MedicationRequest.extension" />
      <sliceName value="prescriptionTaskStatusReason" />
      <min value="0" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMPrescriptionStatusHistory" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.extension:controlledDrug">
      <path value="MedicationRequest.extension" />
      <sliceName value="controlledDrug" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMControlledDrug" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.extension:dispensingInformation">
      <path value="MedicationRequest.extension" />
      <sliceName value="dispensingInformation" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-EPSDispensingInformation" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.extension:NHSBSAPrescriptionType">
      <path value="MedicationRequest.extension" />
      <sliceName value="NHSBSAPrescriptionType" />
      <min value="0" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMPrescriptionType" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.identifier">
      <path value="MedicationRequest.identifier" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="system" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <short value="Each MedicationRequest MUST be identified by an Universal Unique Identifiers (UUIDs) with a system of https://fhir.nhs.uk/Id/prescription-order-item-number" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.identifier:prescriptionOrderItem">
      <path value="MedicationRequest.identifier" />
      <sliceName value="prescriptionOrderItem" />
      <short value="Prescription Order Item" />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="MedicationRequest.identifier:prescriptionOrderItem.system">
      <path value="MedicationRequest.identifier.system" />
      <min value="1" />
      <fixedUri value="https://fhir.nhs.uk/Id/prescription-order-item-number" />
    </element>
    <element id="MedicationRequest.identifier:prescriptionOrderItem.value">
      <path value="MedicationRequest.identifier.value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.status">
      <path value="MedicationRequest.status" />
      <short value="active | cancelled | stopped" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.statusReason">
      <path value="MedicationRequest.statusReason" />
      <mustSupport value="true" />
      <binding>
        <strength value="required" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-DMMedicationRequestStatusReason" />
      </binding>
    </element>
    <element id="MedicationRequest.statusReason.coding">
      <path value="MedicationRequest.statusReason.coding" />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="MedicationRequest.statusReason.coding.system">
      <path value="MedicationRequest.statusReason.coding.system" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.statusReason.coding.code">
      <path value="MedicationRequest.statusReason.coding.code" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.statusReason.coding.display">
      <path value="MedicationRequest.statusReason.coding.display" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.category">
      <path value="MedicationRequest.category" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.category.coding">
      <path value="MedicationRequest.category.coding" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="system" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="1" />
      <max value="1" />
    </element>
    <element id="MedicationRequest.category.coding:patientClassFHIR">
      <path value="MedicationRequest.category.coding" />
      <sliceName value="patientClassFHIR" />
      <max value="1" />
      <binding>
        <strength value="required" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-DMMedicationRequestCategory" />
      </binding>
    </element>
    <element id="MedicationRequest.category.coding:patientClassFHIR.system">
      <path value="MedicationRequest.category.coding.system" />
      <min value="1" />
      <fixedUri value="http://terminology.hl7.org/CodeSystem/medicationrequest-category" />
    </element>
    <element id="MedicationRequest.category.coding:patientClassFHIR.code">
      <path value="MedicationRequest.category.coding.code" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.category.coding:patientClassUK">
      <path value="MedicationRequest.category.coding" />
      <sliceName value="patientClassUK" />
      <max value="1" />
      <binding>
        <strength value="required" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-DMMedicationRequestCategory" />
      </binding>
    </element>
    <element id="MedicationRequest.category.coding:patientClassUK.system">
      <path value="MedicationRequest.category.coding.system" />
      <min value="1" />
      <fixedUri value="https://fhir.nhs.uk/CodeSystem/England-MedicationRequestCategory" />
    </element>
    <element id="MedicationRequest.category.coding:patientClassUK.code">
      <path value="MedicationRequest.category.coding.code" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.medication[x]">
      <path value="MedicationRequest.medication[x]" />
      <type>
        <code value="CodeableConcept" />
      </type>
      <type>
        <code value="Reference" />
        <aggregation value="bundled" />
      </type>
      <mustSupport value="true" />
      <binding>
        <strength value="extensible" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-MedicationCode" />
      </binding>
    </element>
    <element id="MedicationRequest.subject">
      <path value="MedicationRequest.subject" />
      <constraint>
        <key value="nhse-mer-013" />
        <severity value="error" />
        <human value="Length of the supplied NHS Number is wrong." />
        <expression value="identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists().not() or (identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').exists()  and identifier.where(system='https://fhir.nhs.uk/Id/nhs-number').value.matches('^([0-9]{10})$'))" />
      </constraint>
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.subject.reference">
      <path value="MedicationRequest.subject.reference" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.subject.identifier.system">
      <path value="MedicationRequest.subject.identifier.system" />
      <min value="1" />
      <fixedUri value="https://fhir.nhs.uk/Id/nhs-number" />
    </element>
    <element id="MedicationRequest.subject.identifier.value">
      <path value="MedicationRequest.subject.identifier.value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.authoredOn">
      <path value="MedicationRequest.authoredOn" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.requester">
      <path value="MedicationRequest.requester" />
      <min value="1" />
      <constraint>
        <key value="nhse-mer-014" />
        <severity value="error" />
        <human value="requester - An identifier reference or resource reference must be provided" />
        <expression value="(reference.exists() or (identifier.exists()))" />
      </constraint>
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.requester.reference">
      <path value="MedicationRequest.requester.reference" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.recorder">
      <path value="MedicationRequest.recorder" />
      <constraint>
        <key value="nhse-mer-015" />
        <severity value="error" />
        <human value="recorder - An identifier reference or resource reference must be provided" />
        <expression value="(reference.exists() or (identifier.exists()))" />
      </constraint>
    </element>
    <element id="MedicationRequest.basedOn">
      <path value="MedicationRequest.basedOn" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.basedOn.extension">
      <path value="MedicationRequest.basedOn.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="0" />
    </element>
    <element id="MedicationRequest.basedOn.extension:repeatInformation">
      <path value="MedicationRequest.basedOn.extension" />
      <sliceName value="repeatInformation" />
      <short value="Additional repeatInformation" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-EPSRepeatInformation" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.basedOn.extension:orignalPrescriptionId">
      <path value="MedicationRequest.basedOn.extension" />
      <sliceName value="orignalPrescriptionId" />
      <min value="0" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMPrescriptionId" />
      </type>
      <isModifier value="false" />
    </element>
    <element id="MedicationRequest.groupIdentifier">
      <path value="MedicationRequest.groupIdentifier" />
      <short value="groupIdentifier (Short Form Prescription ID)" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.groupIdentifier.extension">
      <path value="MedicationRequest.groupIdentifier.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="1" />
    </element>
    <element id="MedicationRequest.groupIdentifier.extension:PrescriptionOrderUUID">
      <path value="MedicationRequest.groupIdentifier.extension" />
      <sliceName value="PrescriptionOrderUUID" />
      <short value="UUID order number for grouped MedciationRequests" />
      <min value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMPrescriptionId" />
      </type>
    </element>
    <element id="MedicationRequest.groupIdentifier.extension:PrescriptionOrderUUID.value[x].system">
      <path value="MedicationRequest.groupIdentifier.extension.value[x].system" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.groupIdentifier.extension:PrescriptionOrderUUID.value[x].value">
      <path value="MedicationRequest.groupIdentifier.extension.value[x].value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.groupIdentifier.system">
      <path value="MedicationRequest.groupIdentifier.system" />
      <min value="1" />
      <fixedUri value="https://fhir.nhs.uk/Id/prescription-order-number" />
    </element>
    <element id="MedicationRequest.groupIdentifier.value">
      <path value="MedicationRequest.groupIdentifier.value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.courseOfTherapyType">
      <path value="MedicationRequest.courseOfTherapyType" />
      <min value="1" />
      <mustSupport value="true" />
      <binding>
        <strength value="required" />
        <valueSet value="https://fhir.nhs.uk/ValueSet/England-DMMedicationRequestCourseOfTherapy" />
      </binding>
    </element>
    <element id="MedicationRequest.courseOfTherapyType.coding">
      <path value="MedicationRequest.courseOfTherapyType.coding" />
      <min value="1" />
      <max value="1" />
    </element>
    <element id="MedicationRequest.courseOfTherapyType.coding.system">
      <path value="MedicationRequest.courseOfTherapyType.coding.system" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.courseOfTherapyType.coding.code">
      <path value="MedicationRequest.courseOfTherapyType.coding.code" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.note">
      <path value="MedicationRequest.note" />
      <short value="Dispensing Note" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dosageInstruction">
      <path value="MedicationRequest.dosageInstruction" />
      <min value="1" />
      <type>
        <code value="Dosage" />
        <profile value="http://hl7.org/fhir/StructureDefinition/Dosage" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest">
      <path value="MedicationRequest.dispenseRequest" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.id">
      <path value="MedicationRequest.dispenseRequest.id" />
      <max value="0" />
    </element>
    <element id="MedicationRequest.dispenseRequest.extension">
      <path value="MedicationRequest.dispenseRequest.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.extension:performerSiteType">
      <path value="MedicationRequest.dispenseRequest.extension" />
      <sliceName value="performerSiteType" />
      <short value="type of dispensing organisation" />
      <min value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMPerformerSiteType" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.validityPeriod">
      <path value="MedicationRequest.dispenseRequest.validityPeriod" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.validityPeriod.start">
      <path value="MedicationRequest.dispenseRequest.validityPeriod.start" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.numberOfRepeatsAllowed">
      <path value="MedicationRequest.dispenseRequest.numberOfRepeatsAllowed" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.quantity">
      <path value="MedicationRequest.dispenseRequest.quantity" />
      <min value="1" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.quantity.value">
      <path value="MedicationRequest.dispenseRequest.quantity.value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.quantity.unit">
      <path value="MedicationRequest.dispenseRequest.quantity.unit" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.quantity.code">
      <path value="MedicationRequest.dispenseRequest.quantity.code" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.expectedSupplyDuration">
      <path value="MedicationRequest.dispenseRequest.expectedSupplyDuration" />
      <short value="Days Supply" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.expectedSupplyDuration.value">
      <path value="MedicationRequest.dispenseRequest.expectedSupplyDuration.value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.expectedSupplyDuration.code">
      <path value="MedicationRequest.dispenseRequest.expectedSupplyDuration.code" />
      <min value="1" />
      <fixedCode value="d" />
    </element>
    <element id="MedicationRequest.dispenseRequest.performer">
      <path value="MedicationRequest.dispenseRequest.performer" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.performer.extension">
      <path value="MedicationRequest.dispenseRequest.performer.extension" />
      <slicing>
        <discriminator>
          <type value="value" />
          <path value="url" />
        </discriminator>
        <rules value="open" />
      </slicing>
      <min value="0" />
    </element>
    <element id="MedicationRequest.dispenseRequest.performer.extension:dispensingPractitioner">
      <path value="MedicationRequest.dispenseRequest.performer.extension" />
      <sliceName value="dispensingPractitioner" />
      <short value="practitioner who released(/downloaded) the prescription" />
      <min value="0" />
      <max value="1" />
      <type>
        <code value="Extension" />
        <profile value="https://fhir.nhs.uk/StructureDefinition/Extension-England-DMDispensingPerformer" />
      </type>
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.dispenseRequest.performer.identifier">
      <path value="MedicationRequest.dispenseRequest.performer.identifier" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.dispenseRequest.performer.identifier.system">
      <path value="MedicationRequest.dispenseRequest.performer.identifier.system" />
      <min value="1" />
      <fixedUri value="https://fhir.nhs.uk/Id/ods-organization-code" />
    </element>
    <element id="MedicationRequest.dispenseRequest.performer.identifier.value">
      <path value="MedicationRequest.dispenseRequest.performer.identifier.value" />
      <min value="1" />
    </element>
    <element id="MedicationRequest.substitution">
      <path value="MedicationRequest.substitution" />
      <mustSupport value="true" />
    </element>
    <element id="MedicationRequest.substitution.allowed[x]">
      <path value="MedicationRequest.substitution.allowed[x]" />
      <type>
        <code value="boolean" />
      </type>
    </element>
  </differential>
</StructureDefinition>