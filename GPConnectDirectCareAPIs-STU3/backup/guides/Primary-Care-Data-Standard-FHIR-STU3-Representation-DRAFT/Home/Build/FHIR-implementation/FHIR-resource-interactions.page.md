## {{page-title}}

### Requests

Servers SHALL be able to consume and process the following requests for GP Connect FoT:

|Interaction|Path|Request verb|Request content-type|Body|Prefer|Conditional|
|---|---|---|---|---|---|---|
|`read`|`/[type]/[id]`|`GET`|N/A|N/A|N/A|`ETag`|
|`update`|`/[type]/[id]`|`PUT`|R|Resource|O|`If-Match`|
|`delete`|`/[type]/[id]`|`DELETE`|N/A|N/A|N/A|N/A|
|`create`|`/[type]`|`POST`|R|Resource|O|N/A|
|`search`|`/[type]?`|`GET`|N/A|N/A|N/A|N/A|
|`(operation)`|`/[type]/$[name]` `/[type]/[id]/$[name]`|`POST`  <br>`GET`|R  <br>`application/x-www-form-urlencoded`|Parameters  <br>form data|N/A|N/A|

> N/A = not present, R = required, O = optional

### Responses

Servers SHALL be expected to produce the following responses for GP Connect FoT:

|Interaction|Response content-type|Body|Location|Content-location|Versioning|Status codes|
|---|---|---|---|---|---|---|
|`read`|R|R: Resource|N/A|R|`ETag`|`200`, `404`, `410`|
|`update`|R|R: Resource|N/A|R|`ETag`|`200`, `201`, `400`, `404` `405`, `409`, `412`, `422`|
|`delete`|R|R: Operation Outcome|N/A|N/A|N/A|`200`, `204`, `404`, `405`, `409`, `412`|
|`create`|R|R: Resource|R|R|`ETag`|`201`, `400`, `404` `405`, `422`|
|`search`|R|R: Bundle|N/A|N/A|N/A|`200`, `403`|
|`(operation)`|R|R: Parameters/Resource|N/A|N/A|N/A|`200`, `400`, `403`, `404`, `422`|

> N/A = not present, R = required, O = optional

#### Response codes

Servers SHALL produce the following main [HTTP status codes](http://www.iana.org/assignments/http-status-codes/http-status-codes.xhtml):

|HTTP status code|Description|
|---|---|
|`200`|OK|
|`201`|Created|
|`400`|Bad request|
|`401`|Unauthorized|
|`403`|Forbidden|
|`404`|Not found|
|`405`|Method not allowed|
|`409`|Conflict|
|`410`|Gone|
|`412`|Precondition failed|
|`415`|Unsupported media type|
|`422`|Unprocessable entity|
|`500`|Internal server error|
|`501`|Not implemented|

#### [Rejecting updates](https://www.hl7.org/fhir/STU3/http.html#2.1.0.10.1)

[OperationOutcome](https://www.hl7.org/fhir/STU3/operationoutcome.html) may be returned with any HTTP `4xx` or `5xx` response, but is not required - many of these errors may be generated by generic server frameworks underlying a FHIR server.

Servers are permitted to reject update interactions because of integrity concerns or other business rules, and return HTTP status codes accordingly (usually a `422`).

As outlined in the FHIR specification, any of these errors SHOULD be accompanied by an [OperationOutcome](https://www.hl7.org/fhir/STU3/operationoutcome.html) resource that provides additional detail concerning the issue.

Refer to [FHIR Guidance - Error Handling](https://gp-connect-1-6-2.netlify.app/development_fhir_error_handling_guidance) for full details of error codes that SHALL be used when returning an operation outcome error.

### Compartment based access

```
VERB [base]/[compartment_type]/[id]/[type]{?_format=[mime-type]}
```

Each resource type may belong to one or more logical [compartment](http://hl7.org/fhir/STU3/compartmentdefinition.html). A compartment is a logical grouping of resources which share a common property.

Servers SHALL support the `Patient` compartment for `Appointment` access.

The patient compartment includes any resources where the `subject` of the resource is the patient.

For example, to retrieve a list of all a patient’s appointments, use the URL:

```
GET [base]/Patient/[id]/Appointment
```

Servers SHALL support searching within this compartment by `start` and `end` date/time, for example:

```
GET [base]/Patient/[id]/Appointment?start=[{search_prefix}start_date]{&start=[{search_prefix}end_date]}
```

---